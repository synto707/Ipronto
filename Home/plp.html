<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.tailwindcss.com">
</script>
<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
<script src="https://unpkg.com/swiper/swiper-bundle.min.js">
</script>
<style>
    .swiper-button-next,
    .swiper-button-prev {
        background-color: white;
        border-radius: 9999px;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        top: 50% !important;
        transform: translateY(-50%) !important;
        transition: background-color 0.3s, color 0.3s;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .swiper-button-next {
        right: 20px !important;
    }

    .swiper-button-prev {
        left: 20px !important;
    }

    .swiper-button-next::after,
    .swiper-button-prev::after {
        color: black;
        font-size: 16px;
        font-weight: bold;
    }

    .swiper-button-next:hover,
    .swiper-button-prev:hover {
        background-color: #facc15;
    }

    .date-badge {
        background: linear-gradient(to bottom, #facc15, #b8860b);
        width: 45px;
        height: 50px;
        border-radius: 6px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        border: 1px solid black;
    }

    .date-badge span:first-child {
        font-size: 16px;
    }

    .date-badge span:last-child {
        font-size: 12px;
    }

    .image-wrapper {
        position: relative;
        overflow: hidden;
        border-radius: 16px 16px 0 0;
        height: 150px;
    }

    .image-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .image-wrapper:hover img {
        transform: scale(1.50);
    }

    .date-container {
        position: absolute;
        top: 0px;
        left: 16px;
        z-index: 5;
    }

    .swiper-wrapper {
        display: flex;
        gap: 16px !important;
        padding: 10px 16px 20px 16px !important;
        margin: 0 !important;
    }

    .swiper-slide {
        width: 240px !important;
        height: 340px !important;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        background: white;
        display: flex !important;
        flex-direction: column !important;
        flex-shrink: 0 !important;
    }

    .swiper {
        overflow: hidden !important;
        padding: 0 !important;
        margin: 0 -16px !important;
        width: calc(100% + 32px);
    }

    .swiper-button-disabled {
        display: none !important;
    }

    .card-content {
        padding: 12px;
        flex-grow: 1 !important;
        display: flex !important;
        flex-direction: column !important;
    }

    .card-title {
        font-size: 13px !important;
        font-weight: 600;
        margin-bottom: 6px !important;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        flex-grow: 1 !important;
        min-height: 36px !important;
        line-height: 1.2 !important;
    }

    .card-price {
        font-size: 15px !important;
        font-weight: 700;
        color: #15803d;
        margin-bottom: 6px !important;
        margin-top: auto !important;
    }

    .card-detail {
        font-size: 11px !important;
        color: #4b5563;
        display: flex;
        align-items: center;
        margin-bottom: 3px !important;
    }

    .card-detail img {
        width: 11px !important;
        height: 11px !important;
        margin-right: 3px !important;
    }

    .provider-logo {
        height: 22px !important;
        width: 55px !important;
        margin-top: 6px !important;
        margin-top: auto !important;
        padding-top: 6px !important;
    }

    .category-title {
        font-size: 1.4rem !important;
        font-weight: bold;
        color: #1f2937;
        margin-bottom: 0.8rem !important;
        padding-left: 16px !important;
    }

    .icon-btns {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        flex-direction: column;
        gap: 6px;
        z-index: 10;
    }

    .icon-btns button {
        background: white !important;
        padding: 3px !important;
        border-radius: 9999px !important;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 23px !important;
        height: 23px !important;
        transition: all 0.2s ease !important;
    }

    .icon-btns button img {
        width: 13px !important;
        height: 13px !important;
    }

    .category-slider-section {
        margin-bottom: 12px !important;
    }

    .loading-container {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100px;
        gap: 30px;
    }

    .loading-container span {
        font-size: 2rem !important;
        font-weight: 500;
    }

    .loading-dots {
        display: flex;
        gap: 4px;
    }

    .loading-dots span {
        width: 20px;
        height: 20px;
        background-color: #facc15;
        border-radius: 50%;
        display: inline-block;
        animation: bounce 1.4s infinite ease-in-out both;
    }

    .loading-dots span:nth-child(1) {
        animation-delay: -0.32s;
    }

    .loading-dots span:nth-child(2) {
        animation-delay: -0.16s;
    }

    @keyframes bounce {

        0%,
        80%,
        100% {
            transform: scale(0);
        }

        40% {
            transform: scale(1);
        }
    }

    #main-container {
        overflow: hidden;
    }
</style>
<div id="main-container" class="max-w-6xl mx-auto px-0 py-8">
    <div id="loading-indicator" class="loading-container">
        <span>
            Loading events
        </span>
        <div class="loading-dots">
            <span>
            </span>
            <span>
            </span>
            <span>
            </span>
        </div>
    </div>
</div>
<script>
    const apiURL = "https://api.ipronto.com/api/v3/events/searchAll?city=&location=&nearBy=&searchText=&fromDate=1750319574000&toDate=1781769174000&landingPage=&categories=&destinationId=&limit=10&page=1&bounds=%7B%22boundCenter%22:%7B%22lat%22:40.87344192163164,%22lng%22:-74.24690851507893%7D,%22boundZoom%22:1,%22lngW%22:-180,%22latS%22:-53.31003657149456,%22lngE%22:180,%22latN%22:82.07483916635272%7D&priceRange=&createdSince=2025-06-18&upcomingEvents=7";
    // Show loading indicator initially
    const loadingIndicator = document.getElementById("loading-indicator");
    fetch(apiURL)
        .then(res => res.json())
        .then(data => {
            const container = document.getElementById("main-container");
            // Remove loading indicator
            container.innerHTML = '';
            // Group events by category
            const groupedEvents = {};
            const professionalsports = data?.professionalsports?.searchResult || [];
            const musicandconcerts = data?.musicandconcerts?.searchResult || [];
            const liveshows = data?.liveshows?.searchResult || [];
            const tours = data?.tours?.searchResult || [];
            const adventures = data?.adventures?.searchResult || [];
            const activities = data?.activities?.searchResult || [];
            const others = data?.others?.searchResult || [];
            const allEvents = [...professionalsports, ...musicandconcerts, ...liveshows, ...tours, ...adventures, ...activities, ...others];
            allEvents.forEach(event => {
                const categories = event.categories || ["Other"];
                categories.forEach(category => {
                    if (!groupedEvents[category]) {
                        groupedEvents[category] = [];
                    }
                    groupedEvents[category].push(event);
                });
            });
            // Create a slider for each category
            Object.entries(groupedEvents).forEach(([category, events], index) => {
                const sectionId = `swiper-${index}`;
                const eventCount = events.length;
                // Create category section
                const section = document.createElement("div");
                section.className = "mb-0";
                section.innerHTML = `
          <h2 class="category-title">${category} (${eventCount})</h2>
          <div class="relative">
            <div class="swiper" id="${sectionId}">
              <div class="swiper-wrapper" id="${sectionId}-wrapper"></div>
              <div class="swiper-button-prev"></div>
              <div class="swiper-button-next"></div>
            </div>
          </div>
        `;
                container.appendChild(section);
                // Add events to this category's slider
                const wrapper = document.getElementById(`${sectionId}-wrapper`);
                events.forEach(event => {
                    const media = event.images?.[0] || "https://via.placeholder.com/240x150";
                    const title = event.name || "Untitled";
                    const price = event.pickupPointPriceRange?.minpickupprice ?
                        `$${parseFloat(event.pickupPointPriceRange.minpickupprice).toFixed(2)}` : "N/A";
                    const date = event.date || "";
                    const location = (event.destination_name || []).join(", ");
                    const link = event.web_url || "#";
                    const isViator = event.categories?.includes("Adventures");
                    const cleanDate = new Date(date);
                    const day = cleanDate.getDate() || "--";
                    const month = cleanDate.toLocaleString("default", { month: "short" }) || "--";
                    const dateStr = cleanDate.toLocaleDateString("en-US", {
                        month: "short", day: "numeric", year: "numeric"
                    }).replace(",", "");
                    const card = document.createElement("div");
                    card.className = "swiper-slide";
                    card.innerHTML = `
            <a href="${link}" target="_blank" class="block h-full">
              <div class="image-wrapper">
                <img src="${media}" alt="${title}" />
                <div class="date-container">
                  <div class="date-badge">
                    <span>${day}</span>
                    <span>${month.toUpperCase()}</span>
                  </div>
                </div>
                <div class="icon-btns">
                  <button class="bg-white p-1 rounded-full shadow">
                    <img src="https://img.icons8.com/ios-filled/20/000000/facebook-like.png"/>
                  </button>
                  <button class="bg-white p-1 rounded-full shadow">
                    <img src="https://img.icons8.com/ios-filled/20/000000/checkmark.png"/>
                  </button>
                  <button class="bg-white p-1 rounded-full shadow">
                    <img src="https://img.icons8.com/ios-filled/20/000000/share.png"/>
                  </button>
                </div>
              </div>
              <div class="card-content">
                <h3 class="card-title">${title}</h3>
                <div class="card-price">${price}</div>
                <div class="card-detail">
                  <img src="https://img.icons8.com/ios-filled/12/000000/time.png"/>
                  ${dateStr}
                </div>
                <div class="card-detail">
                  <img src="https://img.icons8.com/ios-filled/12/000000/marker.png"/>
                  ${location || "Multiple locations"}
                </div>
                <img src="${isViator ? "https://www.ipronto.com/assets/images/viator_logo.png" : "https://public-pronto.s3.us-west-2.amazonaws.com/dev-assets/pronto-logo/ProntoliveNew.png"}" 
                     class="provider-logo" />
              </div>
            </a>
          `;
                    wrapper.appendChild(card);
                });
                // Initialize swiper for this category
                new Swiper(`#${sectionId}`, {
                    slidesPerView: 4,
                    spaceBetween: 16,
                    navigation: {
                        nextEl: `#${sectionId} .swiper-button-next`,
                        prevEl: `#${sectionId} .swiper-button-prev`
                    },
                    breakpoints: {
                        1280: {
                            slidesPerView: 4,
                            spaceBetween: 16
                        },
                        1024: {
                            slidesPerView: 3,
                            spaceBetween: 16
                        },
                        768: {
                            slidesPerView: 2,
                            spaceBetween: 16
                        },
                        640: {
                            slidesPerView: 1,
                            spaceBetween: 16
                        }
                    }
                });
            });
        })
        .catch(error => {
            console.error("Error fetching data:", error);
            document.getElementById("main-container").innerHTML = `
        <div class="text-red-500 p-4">Error loading events. Please try again later.</div>
      `;
        });
</script>